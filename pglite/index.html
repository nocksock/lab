<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>simple pglite demo with livequeries</title>
    <style>
      :root {
        color-scheme: light dark;
      }
    </style>
  </head>
  <body>
    <h1>pglite</h1>
    <form>
      <input type="text" name="name" />
      <button type="submit">Submit</button>
    </form>

    <ul id="results"></ul>

    <script type="module">
      import { PGlite } from 'https://cdn.jsdelivr.net/npm/@electric-sql/pglite/dist/index.js'
      import { live } from 'https://cdn.jsdelivr.net/npm/@electric-sql/pglite/dist/live/index.js'
      const db = new PGlite({
        dataDir: 'idb://pglite-test',
        extensions: {live}
      })

      await db.sql`CREATE TABLE IF NOT EXISTS test (name TEXT)`

      const {refresh, subscribe, unsubscribe} = await db.live.query(`SELECT * FROM test`, [], (res) => {
        render(res.rows)
      })

      document.querySelector('form').addEventListener('submit', async (e) => {
        e.preventDefault()
        const name = new FormData(e.target).get('name')
        await db.sql`INSERT INTO test (name) VALUES (${name})`
        e.target.reset()
      })

      function render(rows) {
        const results = document.querySelector('#results')
        results.innerHTML = ''
        rows.forEach(({name}) => {
          const li = document.createElement('li')
          li.textContent = name
          results.appendChild(li)
        })
      }
    </script>
  </body>
</html>
